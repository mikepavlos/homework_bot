# homework_bot

### Описание
Телеграм-бот для парсинга состояний ревью проектов. В автоматическом режиме запрашивает состояние, обращаясь к API Практикум.Яндекс, каждые десять минут. Если состояние за этот промежуток времени изменилось - программа выдает ответ, содержащий один из статусов:
- approved - 'Работа проверена: ревьюеру всё понравилось. Ура!'
- reviewing - 'Работа взята на проверку ревьюером.'
- rejected - 'Работа проверена: у ревьюера есть замечания.'
- либо недокумернтированный статус <что-то там>

В проекте также активно задействовано логирование и обработка исключений на случай ошибок в работе программы, сбоев сервера, телеграм или неверных данных со стороны пользователя.

```text
# Пример логов при отсутствии необходимых данных

2023-05-24 15:04:39,506 [CRITICAL] check_tokens, 107: Отсутствует переменная окружения PRACTICUM_TOKEN
2023-05-24 15:04:39,506 [CRITICAL] check_tokens, 107: Отсутствует переменная окружения TELEGRAM_TOKEN  
2023-05-24 15:04:39,506 [CRITICAL] check_tokens, 107: Отсутствует переменная окружения TELEGRAM_CHAT_ID
Программа принудительно остановлена 
```

### Запуск проекта
Клонировать проект

```shell
git clone https://github.com/mikepavlos/homework_bot.git
cd homework_bot
```

Установить и активировать вируальное окружение

```shell
python -m venv venv
```

```shell
# Unix
venv/bin/activate
```

```shell
# Windows
venv/Scripts/activate
```

Установить зависимости

```shell
python -m pip install --upgrade pip
pip install -r requirements.txt
```

В корне создать файл `.env` и внести в него секретные данные:

| Секрет=           | Значение                                                                                                                                                              |
|-------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| PRACTICUM_TOKEN=  | токен для доступа к эндпоинту API Практикум.Домашка <br/>(получить: https://oauth.yandex.ru/authorize?response_type=token&client_id=1d0b9dd4d652455a9eb710d450ff456a) |
| TELEGRAM_TOKEN=   | токен телеграм-бота (@BotFather -> /mybots -> Choose a bot -> API Token)                                                                                              |
| TELEGRAM_CHAT_ID= | id телеграм-чата (@userinfobot)                                                                                                                                       |

Запустить проект локально из IDE (`run`) или из терминала

```shell
python homework.py
```

В указанный чат будут приходить сообщения о последних статусах.

### CI проекта
Для удобства при разработке и внесении изменений в проект реализовано автоматическое тестирование как внутренними тестами (pytest), так и линтером flake8.  
Тестирование запускается с использованием GitHab Actions при `push` проекта в основную ветку репозитория GitHab.  
После успешного прохождения тестов на телеграм приходит сообщение. 
Для реализации этой возможности необходимо после создания своего репозитория на GitHab прописать данные телеграм в 
```text
<Проект> -> Settings -> Secrets and variables -> Actions -> New repository secret
```
TELEGRAM_TO - id телеграм-чата (узнать в чате: @userinfobot; или взять из своего `.env`)  
TELEGRAM_TOKEN - токен телеграм-бота (узнать: @BotFather -> /mybots -> Choose a bot -> API Token; или взять из своего `.env`)

#### Автор: 
mikepavlos (Михаил Павлов)  
email mike_pavlovsky@hotmail.com  
telegram @miha1is
